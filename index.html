
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>T√≠nh ph√≠ g√≥i t·∫°p ch√≠ ‚Äî B√¨a ¬∑ Card ¬∑ Pola ¬∑ POS</title>
  <style>
    :root{--bg:#f7f7f8;--card:#ffffff;--ink:#0f172a;--muted:#6b7280;--accent:#0f172a;--border:#e5e7eb;}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--ink);}
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:24px;}
    .panel{width:100%;max-width:960px;background:var(--card);border-radius:16px;box-shadow:0 8px 30px rgba(0,0,0,.06);padding:24px;}
    h1{font-size:clamp(22px,2.5vw,28px);margin:0 0 4px;font-weight:800;letter-spacing:-0.02em}
    .sub{color:var(--muted);margin:0 0 16px}
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    @media (min-width:640px){.grid{grid-template-columns:repeat(4,minmax(0,1fr));}}
    .chip{display:flex;align-items:center;gap:8px;padding:12px;border:1px solid var(--border);border-radius:12px;background:#fff;cursor:pointer;transition:.2s}
    .chip:hover{background:#f3f4f6}
    .chip input{width:16px;height:16px}
    .chip.active{background:var(--accent);color:#fff;border-color:var(--accent)}
    .section{margin-top:20px;display:grid;gap:16px}
    @media (min-width:768px){.section{grid-template-columns:1fr 1fr}}
    .card{background:#fafafa;border:1px solid var(--border);border-radius:12px;padding:16px}
    .card h2{margin:0 0 8px;font-size:16px}
    ul{margin:0;padding-left:18px;color:#374151;font-size:14px}
    .total{background:var(--accent);color:#fff;border-radius:12px;padding:20px}
    .total .muted{opacity:.85;font-size:12px;margin:0}
    .total .big{margin:4px 0 0;font-size:36px;font-weight:900;letter-spacing:-0.02em}
    .row{display:flex;gap:12px;flex-wrap:wrap;margin-top:18px}
    .btn{padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:#fff;cursor:pointer}
    .btn:hover{background:#f3f4f6}
    .footer{margin-top:24px;font-size:12px;color:#6b7280}
    .tag{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:#eef2ff;color:#3730a3;font-weight:600;font-size:12px}
    .tag svg{width:14px;height:14px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <header>
        <h1>T√≠nh ph√≠ g√≥i t·∫°p ch√≠</h1>
        <p class="sub">4 l·ª±a ch·ªçn: B√¨a, Card, Pola, POS</p>
      </header>

      <div class="grid" id="options">
        <!-- options generated by JS -->
      </div>

      <div class="section">
        <div class="card">
          <h2>Quy t·∫Øc t√≠nh</h2>
          <ul>
            <li><strong>TH1 (c√≥ b√¨a):</strong> ch·ªçn <strong>b√¨a</strong> ‚áí ph√≠ c∆° b·∫£n <strong>3k</strong>; m·ªói m√≥n th√™m ngo√†i b√¨a ‚áí <strong>+1k/m√≥n</strong>.</li>
            <li><strong>TH2 (kh√¥ng b√¨a):</strong> n·∫øu <em>kh√¥ng ch·ªçn b√¨a</em> nh∆∞ng ch·ªçn c√°c m√≥n c√≤n l·∫°i ‚áí <strong>3k cho m√≥n th·ª© nh·∫•t</strong> v√† <strong>+0.5k</strong> cho <em>m·ªói m√≥n ti·∫øp theo</em>.</li>
            <li>N·∫øu kh√¥ng ch·ªçn g√¨ ‚áí <em>0k</em>.</li>
          </ul>
        </div>

        <div class="total">
          <p class="muted">T·ªïng m·ª•c ƒë√£ ch·ªçn: <span id="count">0</span> ¬∑ √Åp d·ª•ng: <span id="rule">Ch∆∞a ch·ªçn</span></p>
          <p class="big" id="total">0k</p>
          <p class="muted">*ƒê∆°n v·ªã hi·ªÉn th·ªã theo ngh√¨n. V√≠ d·ª• 3k = 3.000.</p>
        </div>
      </div>

      <div class="row">
        <button class="btn" id="resetBtn">Reset</button>
        <span class="tag" id="shareTag" title="Link c√≥ k√®m tr·∫°ng th√°i l·ª±a ch·ªçn, share cho team xem nhanh nh√©!">
          <!-- link icon -->
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.71"/>
          </svg>
          <span id="shareText">Sao ch√©p link tr·∫°ng th√°i</span>
        </span>
      </div>

      <div class="footer">
        Built for Qu·ª≥nh üíô ‚Äî single-file, kh√¥ng c·∫ßn build. C√≥ th·ªÉ up GitHub Pages/Netlify l√† ch·∫°y.
      </div>
    </div>
  </div>

  <script>
    // ====== Config ======
    const ITEMS = [
      { id: "bia",  label: "B√¨a"  },
      { id: "card", label: "Card" },
      { id: "pola", label: "Pola" },
      { id: "pos",  label: "POS"  },
    ];

    const state = { bia:false, card:false, pola:false, pos:false };

    // ====== Helpers ======
    const qs = sel => document.querySelector(sel);
    const qsa = sel => Array.from(document.querySelectorAll(sel));

    function formatK(n){
      return Number.isInteger(n) ? n + "k" : n.toFixed(1).replace(/\.0$/,'') + "k";
    }

    function calculatePrice(sel){
      const picked = Object.entries(sel).filter(([,v])=>v).map(([k])=>k);
      const count = picked.length;

      if (sel.bia){ // TH1
        const extras = picked.filter(id=>id!=="bia").length;
        return 3 + extras * 1;
      }
      if (!sel.bia && count>0){ // TH2
        return 3 + (count - 1) * 0.5;
      }
      return 0;
    }

    function detectRule(sel){
      const count = Object.values(sel).filter(Boolean).length;
      if (sel.bia) return "TH1 (c√≥ b√¨a)";
      if (!sel.bia && count>0) return "TH2 (kh√¥ng b√¨a)";
      return "Ch∆∞a ch·ªçn";
    }

    function renderOptions(){
      const root = qs("#options");
      root.innerHTML = "";
      for (const it of ITEMS){
        const id = "opt-"+it.id;
        const label = document.createElement("label");
        label.className = "chip" + (state[it.id] ? " active" : "");
        label.htmlFor = id;

        const input = document.createElement("input");
        input.type = "checkbox";
        input.id = id;
        input.checked = state[it.id];
        input.addEventListener("change", (e)=>{
          state[it.id] = e.target.checked;
          render();
          updateURLState();
        });

        const span = document.createElement("span");
        span.textContent = it.label;

        label.appendChild(input);
        label.appendChild(span);
        root.appendChild(label);
      }
    }

    function updateSummary(){
      const total = calculatePrice(state);
      const count = Object.values(state).filter(Boolean).length;
      qs("#total").textContent = formatK(total);
      qs("#count").textContent = count;
      qs("#rule").textContent = detectRule(state);
      // active class updates
      qsa(".chip").forEach((el, idx)=>{
        const key = ITEMS[idx].id;
        el.classList.toggle("active", !!state[key]);
      });
    }

    function resetAll(){
      for (const k in state) state[k] = false;
      render();
      updateURLState();
    }

    // Persist state to URL (?sel=bia,card)
    function updateURLState(){
      const selected = Object.entries(state).filter(([,v])=>v).map(([k])=>k);
      const params = new URLSearchParams(location.search);
      if (selected.length) params.set("sel", selected.join(",")); else params.delete("sel");
      const newURL = location.pathname + (params.toString() ? "?" + params.toString() : "");
      history.replaceState(null, "", newURL);
    }

    function loadStateFromURL(){
      const params = new URLSearchParams(location.search);
      const sel = (params.get("sel") || "").split(",").filter(Boolean);
      for (const k in state) state[k] = sel.includes(k);
    }

    async function copyShareLink(){
      try{
        const url = location.href;
        await navigator.clipboard.writeText(url);
        qs("#shareText").textContent = "ƒê√£ sao ch√©p ‚úÖ";
        setTimeout(()=>qs("#shareText").textContent = "Sao ch√©p link tr·∫°ng th√°i", 1600);
      }catch(e){
        console.warn(e);
        qs("#shareText").textContent = "Kh√¥ng sao ch√©p ƒë∆∞·ª£c :(";
        setTimeout(()=>qs("#shareText").textContent = "Sao ch√©p link tr·∫°ng th√°i", 1600);
      }
    }

    function render(){
      renderOptions();
      updateSummary();
    }

    // Boot
    loadStateFromURL();
    render();
    qs("#resetBtn").addEventListener("click", resetAll);
    qs("#shareTag").addEventListener("click", copyShareLink);
  </script>
</body>
</html>
